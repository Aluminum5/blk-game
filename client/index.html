<!DOCTYPE html>
<html>
  <head>
    <title>BLK (info)</title>
    <link rel="stylesheet" href="index.css"/>
  </head>
  <body>
    <div id="column">
      <div id="title">BLK, by <a href="http://noxa.org">benvanik</a></div>
      <br/>
      <div class="break"/>
      <br/>
      <div id="about">
        This is a little tech demo built to show off a high-fidelity native
        Javascript gaming experience and, as a side-effect, develop a low-level
        framework for web games - no C/Java/etc-to-JS here - it's pure JS!
      </div>
      <br/>
      <br/>
      <div id="go">
        &gt; <a href="game.html?host=local://blk-server-0" target="_blank">Run Locally</a>
        <br/>
        <br/>
        &gt; <a href="game.html?host=ws://173.160.235.109:1338" target="_blank" id="joinLink">Join Multiplayer</a>
        <br/>
        &nbsp;&nbsp;&nbsp;Name: <input id="name" type="text" value="User"/>
      </div>
      <br/>
      <br/>
      <div id="browser-line">
        <div class="browser-logo chrome-icon"></div> Use Chrome 17+ or <a href="http://tools.google.com/dlpage/chromesxs" target="_blank">Canary</a> for the full experience!
        <br/>
        <br/>
        <div style="clear: both"/>
        <div class="browser-logo firefox-icon"></div> Firefox 8+ works too!
        <br/>
        <br/>
        <div style="clear: both"/>
        <div class="browser-logo safari-icon"></div> Safari 5+ w/ <span class="command">Enable WebGL</span> on in the Develop menu
      </div>
      <div id="warnings">
      </div>
      <br/>
      <div id="help">
        <span class="section">Help/Controls</span>
        <br/>
        <ul>
          <li>WSAD keys to move around (QZ to change elevation)
          <li>Click and drag the mouse to change the view
          <li>1-6 keys or mouse wheel to change the current block type
          <li>Left click to place a block of the current type
          <li>Right click or ctrl-click to remove a block
          <li>Alt-enter to toggle fullscreen mode
          <li>T to chat
        </ul>
        If you run the demo with no arguments you'll be connected to your own
        server. If running in a browser that supports SharedWorkers (such as
        the latest Chrome) you can even open multiple tabs and play in the same
        world.
        <br/>
        <br/>
        Append <span class="command">?host={some address}</span> to connect to a
        remote server. For example, <span class="command">?host=ws://127.0.0.1:1337</span>
        to connect to a local node.js server over WebSockets.
      </div>
      <br/>
      <br/>
      <div id="tech">
        <span class="section">Game Library</span>
        <br/>
        <br/>
        Underlying this demo is a highly modularized library that sits atop
        <a href="http://code.google.com/closure/">Google Closure</a>, using the
        Closure Library as a base and the Closure Compiler to build the tiny
        output Javascript files. Designed to be a set of tools to enable rapid
        high-quality games, it's not an engine (like Unity) or scene graph (like
        three.js), but more like XNA or SDL. Pick what you need, get started
        quickly, and spend timing writing game code vs. platform abstractions.
      </div>
      <br/>
      <div id="features">
        <span class="section">Game Library Features</span>
        <ul>
          <li>Runtime
            <ul>
              <li>Robust game loop management
              <li>Idle state/hidden tab tracking
            </ul>
          <li>Audio
            <ul>
              <li>3D positional sound via <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html">Web Audio API</a>
              <li>Efficient sound bank representation (single file transfer) +
                  tools for creation
              <li>Efficient music playback
            </ul>
          <li>Graphics
            <ul>
              <li>Display supporting orientation changes, fullscreen mode, etc
              <li>WebGL context loss/restore handling
              <li>Texture atlases and sprite batch rendering
              <li>WebGL shader program abstraction
              <li>Bitmap fonts with kerning and layout
            </ul>
          <li>Input abstraction layer
            <ul>
              <li><a href="http://dvcs.w3.org/hg/webevents/raw-file/default/mouse-lock.html">Mouse Lock</a> support
              <li>(coming soon) on-screen dpad and accelerometer
              <li>(coming soon) <a href="http://dvcs.w3.org/hg/webevents/raw-file/default/gamepad.html">gamepad</a> support
              <li>(coming soon) input action map/normalization
            </ul>
          <li>Multiplayer networking
            <ul>
              <li>Client/server session management
              <li>Full client-side input prediction and entity interpolation
              <li>Synchronized clocks
              <li>Localhost server via Web Workers
              <li>SharedWorker for multi-tab local networking
              <li>node.js server via WebSockets (100% shared code)
              <li>Efficient network binary representation
              <li>(coming soon) authentication via ID providers
            </ul>
          <li>Math and Utilities
            <ul>
              <li>Axis-aligned bounding box
              <li>Octree
              <li>Quaternion, ray, vec enhancements
              <li>Seedable PRNG
            </ul>
        </ul>
      </div>
      <div>
        <span class="section">Why Closure?</span>
        <ul>
          <li>Closure Compiler generates some of the smallest Javascript out there
          <li>Off-the-shelf dependency tracking and build system
          <li>Compiler inlining can drastically help performance (and can only get better)
          <li>Closure Library contains a lot of useful functionality
            <ul>
              <li>Localization/i18n
              <li>Array, object, and string extensions
              <li>Data structures
              <li>DOM/CSS/etc templating and abstractions
              <li>Rich and efficient vector math library (one of the fastest!)
              <li>Well tested and maintained
            </ul>
          <li>Native Javascript - no plugins or extensions required to get the functionality
        <ul>
      </div>
      <br/>
      </div>
      <script>
        function makeWarnings(div) {
          function testWebGL() {
            var canvas = document.createElement('canvas');
            if (canvas) {
              var names = ['webgl', 'experimental-webgl'];
              for (var n = 0; n < names.length; n++) {
                var gl = canvas.getContext(names[n]);
                if (gl) {
                  return true;
                }
              }
            }
            return false;
          }
          function testWebAudio() {
            return !!window.webkitAudioContext || !!window.AudioContext;
          }
          function testMouseLock() {
            return !!window.navigator.pointer ||
                !!window.navigator.mozPointer ||
                !!window.navigator.webkitPointer;
          }
          function testWebSockets() {
            return !!window.WebSocket || !!window.MozWebSocket;
          }
          function testFileSystem() {
            return !!window.webkitStorageInfo && !!window.webkitRequestFileSystem;
          }
          function testWebWorker() {
            return !!window.Worker;
          }
          function testSharedWorker() {
            // Only supported in Chrome
            if (window.navigator.userAgent.indexOf('Chrome') != -1) {
              return !!window.SharedWorker;
            }
            return false;
          }

          function addStatusLine(ul, feature, critical, supportFunc, info) {
            var supported = false;
            try {
              supported = supportFunc();
            } catch (e) {
              if (window.console) {
                window.console.log(e);
              }
            }

            var li = document.createElement('li');
            li.appendChild(document.createTextNode(feature + ': '));
            var statusSpan = document.createElement('span');
            if (supported) {
              statusSpan.className = 'status-info';
              statusSpan.appendChild(document.createTextNode('supported'));
              li.appendChild(statusSpan);
            } else {
              if (critical) {
                var statusSpan = document.createElement('span');
                statusSpan.className = 'status-error';
              statusSpan.appendChild(document.createTextNode('unsupported'));
                li.appendChild(statusSpan);
              } else {
                var statusSpan = document.createElement('span');
                statusSpan.className = 'status-warning';
                statusSpan.appendChild(document.createTextNode('unsupported'));
                li.appendChild(statusSpan);
              }
              if (info) {
                var infoSpan = document.createElement('span');
                infoSpan.className = 'info';
                infoSpan.appendChild(document.createTextNode(' (' + info + ')'));
                li.appendChild(infoSpan);
              }
            }
            ul.appendChild(li);
          }

          var ul = document.createElement('ul');
          div.appendChild(ul);

          addStatusLine(ul,
              'WebGL', true,
              testWebGL,
              'nothing will work!');
          addStatusLine(ul,
              'WebSockets', false,
              testWebSockets,
              'no multiplayer');
          addStatusLine(ul,
              'Web Workers', false,
              testWebWorker,
              'no local play');
          addStatusLine(ul,
              'SharedWorker', false,
              testSharedWorker,
              'no local multiplayer');
          addStatusLine(ul,
              'File System', false,
              testFileSystem,
              'no local saving');
          addStatusLine(ul,
              'Web Audio API', false,
              testWebAudio,
              'no sounds');
          addStatusLine(ul,
              'Mouse Lock', false,
              testMouseLock);
        }
        makeWarnings(document.getElementById('warnings'));

        var nameBox = document.getElementById('name');
        function loadName() {
          if (!window.localStorage) {
            return;
          }
          var name = window.localStorage.getItem('blk_user');
          if (name && name.length) {
            nameBox.value = name;
          } else {
            nameBox.value = 'User';
          }
        }
        function saveName() {
          if (!window.localStorage) {
            return;
          }
          var name = nameBox.value;
          if (!name || !name.length) {
            name = 'User';
          }
          window.localStorage.setItem('blk_user', name);
        }
        loadName();
        function updateLink() {
          var joinLink = document.getElementById('joinLink');
          joinLink.href = 'game.html?host=ws://173.160.235.109:1338&userName=' +
              nameBox.value;
          saveName();
        }
        updateLink();
        nameBox.addEventListener('change', updateLink, false);
      </script>
  </body>
</html>
